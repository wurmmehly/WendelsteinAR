<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <title>Wendelstein Digital - Fenster</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <script src="https://cdn.jsdelivr.net/gh/lizard-isana/orb.js@v2.4/build/min/orb-core.v2.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="js/load-sky.js"></script>
    <script src="js/telescope-control.js"></script>
  </head>

  <body style="margin: 0; overflow: hidden">
    <a-scene
      vr-mode-ui="enabled: false"
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false"
      renderer="antialias: false; logarithmicDepthBuffer:true"
      load-sky
    >
      <a-assets>
        <a-mixin
          id="waypointFrame"
          geometry="primitive: circle; radius: 5"
          material="color: white; shader: flat"
          animation__scale="property: scale; to: 1.2 1.2 1.2; dur: 200; startEvents: raycaster-intersected"
          animation__scale_reverse="property: scale; to: 1 1 1; dur: 200; startEvents: raycaster-intersected-cleared"
        ></a-mixin>
        <a-mixin
          id="waypointImage"
          geometry="primitive: circle; radius: 4.9"
          material="color: white; shader: flat"
          material="shader: flat"
          position="0 0 0.005"
        ></a-mixin>

        <!-- "material > src" soll von dem Element selbst übergeschrieben werden -->
        <a-mixin
          id="infoPanelImage"
          geometry="primitive: plane; width: 1.3; height: 0.81"
          material="src: #objectImage; shader: flat; transparent: true"
          position="0 0.495 0.002"
        ></a-mixin>

        <a-mixin
          id="hologramPanel"
          geometry="primitive: plane; width: 100; height: 120"
          material="color: #999999; opacity: .5; transparent: false"
          scale=".2 .2 .2"
          position="0 -15 0"
          visible="false"
        ></a-mixin>
        <a-mixin
          id="hologramTitle"
          position="0 40 0"
          text="
            shader: msdf;
            baseline: top;
            align: center;
            width: 135;
            font: https://cdn.aframe.io/examples/ui/Viga-Regular.json;
            color: white;
            transparent: false"
        ></a-mixin>
        <a-mixin
          id="hologramDesc"
          position="0 30 0"
          text="
            shader: msdf;
            baseline: top;
            align: center;
            font: roboto;
            color: white;
            width: 95;
            wrapCount: 45;
            transparent: false;"
        ></a-mixin>
      </a-assets>

      <!-- Beim Klick auf dieses Element wird das "infoPanel" geschlossen -->
      <!-- das wird von onWaypointClick in js/load-sky.js vergrössert, nur wenn Information angezeigt wird. -->
      <a-entity
        id="cancelBubble"
        position="0 0 0"
        geometry="primitive: sphere; radius: 2.0"
        material="color: red; side: back; shader: flat"
        scale="0.001 0.001 0.001"
        visible="false"
        class="raycastable"
      >
      </a-entity>

      <!-- Kamera nutzt echte GPS-Position des Geräts -->
      <!-- Dieses Cursor kann beim Klick das Info-Panel schließen -->
      <a-camera
        id="camera"
        gps-projected-camera
        cursor="rayOrigin: mouse"
        raycaster="objects: #cancelBubble"
        telescope-control
        rotation="0 0 0"
      >
        <!-- Den Hintergrund verdunkeln, während Information gezeigt wird -->
        <a-entity
          id="fadeBackground"
          geometry="primitive: sphere; radius: 2.5"
          material="color: #999999; side: back; shader: flat; blending: subtractive;"
          visible="false"
        ></a-entity>

        <!-- Info-Panel des ausgewählten Objekts -->
        <a-entity
          id="infoPanel"
          position="0 0 -0.01"
          visible="false"
          scale="0.001 0.001 0.001"
          geometry="primitive: plane; width: 1.3; height: 1.8"
          material="color: #333333; shader: flat; transparent: false"
        >
          <!-- NOTIZ: Diese Schriftarten (Viga regular & roboto) zeigt die Zeichnen ä, ü, ö, und ß nicht richtig an.
                    Die erste 3 zeigt wie a, u, und o an, und der ß zeigt ganz nicht an. Ich bin nicht ganz sicher,
                    wie eine bessere Schriftart benutzt werden kann -->
          <a-entity
            id="objectTitle"
            position="-0.6 -0.1 0"
            text="shader: msdf; anchor: left; width: 1.5; font: https://cdn.aframe.io/examples/ui/Viga-Regular.json; color: white; value: Unbekanntes Objekt"
          ></a-entity>
          <!-- Defaultwert; soll aktuelisiert werden, wenn man auf ein Objekt klickt -->
          <a-entity
            id="objectDescription"
            position="-0.55 -0.2 0"
            text="
              baseline: top;
              shader: msdf;
              anchor: left;
              font: roboto;
              color: white;
              width: 1.1;
              wrapCount: 50;
              value: Keine Beschreibung."
          ></a-entity>
          <!-- Defaultwert; soll aktuellisiert werden, wenn man auf ein Objekt klickt -->
        </a-entity>
      </a-camera>

      <!-- Modell an GPS-Koordinaten -->
      <a-entity
        id="fraunhoferRig"
        scale=".1 .1 .1"
        gps-projected-entity-place="latitude: 47.703563; longitude: 12.012455"
      >
        <a-entity
          id="fraunhoferPedestal"
          gltf-model="models/fraunhofer/pedestal.glb"
        >
          <a-entity
            id="fraunhoferTopPart"
            gltf-model="models/fraunhofer/topPart.glb"
            rotation="0 0 0"
          >
            <!-- "Rig" benötigt, um das Teleskop richtig zu drehen (um die richtige Achse) -->
            <a-entity
              id="fraunhoferTelescopeRig"
              position="0 32.09 0"
              rotation="90 0 0"
            >
              <a-entity
                id="fraunhoferTelescope"
                gltf-model="models/fraunhofer/telescope.glb"
                position="0 -32.09 0"
              ></a-entity>

              <a-cursor
                id="fraunhoferRaycaster"
                raycaster="objects: .waypoint; far: 1e5"
                fuse="true"
              ></a-cursor>

                <a-cone
                  id="fraunhoferBeam"
                  color="#f0ff72"
                  opacity=".2"
                position="0 0 -500"
                  rotation="-90 0 0"
                  height="1000"
                  radius-bottom=".5"
                radius-top="50"
                ></a-cone>
              </a-entity>
            </a-entity>
          </a-entity>
        </a-entity>
    </a-scene>
  </body>
</html>
